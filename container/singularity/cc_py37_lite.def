BootStrap: docker
From: centos

%environment
    # PATHS
    export PATH=/opt/miniconda3/bin:$PATH
    source activate py37

%post
    # bind paths
    mkdir -p /aloy
    mkdir -p /aloy/home
    mkdir -p /aloy/data
    mkdir -p /aloy/scratch
    mkdir -p /aloy/web_checker
    mkdir -p /slgpfs
    
    # update yum
    yum update -y

    # basic packages
    yum install -y gcc \
                   gcc-c++ \
                   gcc-gfortran \
                   cmake \
                   make \
                   git \
                   wget \
                   curl \
                   which \
                   vim \
                   bzip2 \
                   bzip2-devel \
                   file \
                   libXrender \
                   libXext \
                   postgresql-server \
                   postgresql-contrib \
                   epel-release 

    # conda
    mkdir -p /opt/miniconda3
    cd /opt/miniconda3 
    wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh
    bash Miniconda3-latest-Linux-x86_64.sh -p /opt/miniconda3 -b -f
    rm Miniconda3-latest-Linux-x86_64.sh
    export PATH=/opt/miniconda3/bin:$PATH

    # create and activate conda enviroment
    conda update conda -y
    conda create --name=py37 python=3.7 -y
    source activate py37

    # basic requirements
    pip install numpy
    pip install h5py
    pip install psycopg2-binary
    pip install pandas
    pip install networkx
    pip install autologging
    pip install scipy
    pip install sqlalchemy
    pip install paramiko
    pip install sklearn
    pip install csvsort
    pip install seaborn
    pip install tqdm
    pip install apache-airflow                    # Install airflow for the pipeline
    # unittest utils
    pip install pytest
    pip install mock
