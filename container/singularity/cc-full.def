BootStrap: docker
From: centos

%environment
    # PATHS
    export PATH=/opt/miniconda2/bin:$PATH
    source activate py27

%post
    # bind paths
    mkdir /aloy
    mkdir /aloy/home
    mkdir /aloy/data
    mkdir /aloy/scratch
    mkdir /aloy/web_checker
    mkdir /slgpfs
    
    # update yum
    yum update -y

    # basic packages
    yum install -y gcc \
                   g++ \
                   gcc-c++ \
                   gfortran \
                   gcc-gfortran \
                   cmake \
                   make \
                   git \
                   wget \
                   curl \
                   which \
                   vim \
                   bzip2 \
                   bzip2-devel \
                   file \
                   libXrender \
                   libXext \
                   postgresql-server \
                   postgresql-contrib

    # conda
    mkdir /opt/miniconda2 
    cd /opt/miniconda2 
    wget https://repo.continuum.io/miniconda/Miniconda2-latest-Linux-x86_64.sh
    bash Miniconda2-latest-Linux-x86_64.sh -p /opt/miniconda2 -b -f
    rm Miniconda2-latest-Linux-x86_64.sh
    export PATH=/opt/miniconda2/bin:$PATH

    # create and activate conda enviroment
    conda create --name=py27 python=2.7.10 -y
    source activate py27

    # conda-specific packages
    conda install -y -c rdkit rdkit               # Open-Source Cheminformatics Software
    conda install -y -c openbabel openbabel       # chemical toolbox
    conda install -y mkl-service                  # change the number of CPUâ€™s MKL is using
    conda install -y anaconda-client              # client that provides an interface to Anaconda Cloud
    conda install -y faiss-cpu -c pytorch         # facebook trick for sparsity
    conda install -y -c conda-forge hdbscan       # clustering

    # utility packages
    pip install ipython
    pip install six                               # py2/py3 compatibility
    pip install pytest                            # unit-testing
    pip install autologging                       # logging handler
    pip install paramiko                          # ssh client
    pip install termcolor                         # terminal output with colors
    pip install standardiser                      # standardising molecules
    pip install psycopg2-binary                   # Postgesql driver
    pip install xlrd                              # Extract data from Excel spreadsheets
    pip install cmapPy                            # interacting with .gctx and .gct files, and other Connectivity Map resources
    pip install e3fp                              # 3D molecular fingreprints
    pip install csvsort                           # Sort csv
    pip install intbitset                         # sort unsigned integers
    pip install cython                            # C extensions
    pip install sqlalchemy                        # ORM SQL
    pip install sphinx                            # to generate docs
    pip install sphinx_rtd_theme                  # docs theme.
    pip install patool                            # unzipping
    pip install wget                              # download library
    pip install timeout_decorator                 # method timeout
    pip install tqdm                              # handy progress-bar
    # data packages
    pip install numpy                             # best numerical library ever
    pip install pandas                            # handles table-like datastracture
    pip install scipy                             # scientific python
    pip install theano                            # Optimize evaluate math expressions
    pip install h5py                              # HDF5 via python
    pip install fancyimpute                       # matrix completion and imputation algorithms
    # graph packages
    pip install networkx                          # graph data stracture and algos

    ## install SNAP.py
    wget  https://snap.stanford.edu/snappy/release/snap-4.1.0-4.1-centos6.5-x64-py2.6.tar.gz
    tar zxvf snap-4.1.0-4.1-centos6.5-x64-py2.6.tar.gz
    cd snap-4.1.0-4.1-centos6.5-x64-py2.6
    python setup.py install
    cd ..
    rm snap-4.1.0-4.1-centos6.5-x64-py2.6 -rf

    # visualization packages
    pip install matplotlib                        # chart library :)
    pip install seaborn                           # prettier graph built on top of matplotlib
    # ML packages
    pip install scikit-learn                      # entry level ML in python
    pip install gensim                            # topic modelling word2vec
    pip install tensorflow                        # neural network library
    pip install adanet==0.5.0                     # automl for NN
    pip install keras                             # NN API
    pip install MulticoreTSNE                     # tSNA algo

    # install local SBNB devpi packages
    DEVPI_HOST=10.7.108.15
    DEVPI_PORT=3141
    alias sbnb_pip='pip install --index http://$DEVPI_HOST:$DEVPI_PORT/root/dev/ --trusted-host $DEVPI_HOST'
    sbnb_pip pqkmeans==1.0.4                      # slighty modified pqkmeans

    # chemical beauty QED
    curl -LO http://silicos-it.be.s3-website-eu-west-1.amazonaws.com/_downloads/qed-1.0.1.tar.gz
    mv qed-*.tar.gz /usr/local/src/
    cd /usr/local/src/
    tar -xvf qed-*.tar.gz
    cd qed-*
    python setup.py install

    # APSW stands for Another Python SQLite Wrapper
    pip install https://github.com/rogerbinns/apsw/releases/download/3.24.0-r1/apsw-3.24.0-r1.zip --global-option=fetch --global-option=--version --global-option=3.24.0 --global-option=--all --global-option=build --global-option=--enable-all-extensions

    #Install jupyter to use notebooks
    pip install jupyter

    #Install the chemical checker package through git repository
    cd /opt

    git clone http://gitlab.sbnb.org/project-specific-repositories/chemical_checker.git


