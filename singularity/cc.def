BootStrap: docker
From: centos

%environment
    # PATHS
    export PATH=/opt/miniconda2/bin:$PATH
    export PATH=/opt/nextflow:$PATH

%runscript
    source activate py27
    alias ll='ls -l'
    alias ipy='ipython'
    alias py='python'

%post
    # bind paths
    mkdir /aloy
    mkdir /aloy/home
    mkdir /aloy/data
    mkdir /aloy/scratch
    mkdir /aloy/web_checker
    mkdir /slgpfs
    
    # update yum
    yum update -y

    # basic packages
    yum install -y gcc \
                   g++ \
                   gcc-c++ \
                   gfortran \
                   gcc-gfortran \
                   cmake \
                   make \
                   git \
                   wget \
                   curl \
                   which \
                   vim \
                   bzip2 \
                   bzip2-devel \
                   file \
                   libXrender \
                   libXext

    # conda
    mkdir /opt/miniconda2 
    cd /opt/miniconda2 
    wget https://repo.continuum.io/miniconda/Miniconda2-latest-Linux-x86_64.sh
    bash Miniconda2-latest-Linux-x86_64.sh -p /opt/miniconda2 -b -f
    rm Miniconda2-latest-Linux-x86_64.sh
    export PATH=/opt/miniconda2/bin:$PATH

    # create and activate conda enviroment
    conda create --name=py27 python=2.7.10 -y
    source activate py27

    # utility packages
    pip install ipython
    pip install six # py2/py3 compatibility
    pip install pytest # unit-testing
    pip install autologging # logging handler
    pip install paramiko # ssh client
    pip install termcolor # terminal output with colors
    pip install standardiser # standardising molecules
    pip install psycopg2 # Postgesql driver
    pip install xlrd # Extract data from Excel spreadsheets
    pip install cmapPy # interacting with .gctx and .gct files, and other Connectivity Map resources
    pip install e3fp # 3D nolecular fingreprints
    pip install gensim # Topic modeling
    pip install csvsort # Sort csv
    pip install intbitset
    pip install cython # C extensions
    pip install sqlalchemy # ORM SQL
    pip install sphinx # to generate docs
    pip install sphinx_rtd_theme # docs theme.
    pip install patool # unzipping
    pip install wget # download library
    # data packages
    pip install numpy # best numerical library ever
    pip install pandas # handles table-like datastracture
    pip install scipy # 
    pip install theano # Optimize evaluate math expressions
    pip install h5py # HDF5 via python
    pip install tqdm # handy progress-bar
    # graph packages
    pip install networkx # graph data stracture and algos
    # visualization packages
    pip install matplotlib # chart library :)
    pip install seaborn # prettier graph built on top of matplotlib
    pip install datashader # nice density plot with lot of data
    # ML packages
    pip install scikit-learn # entry level ML in python
    pip install gensim # topic modelling word2vec
    pip install tensorflow # neural network library
    pip install adanet # automl for NN
    pip install keras # NN API
    pip install hdbscan # clustering
    pip install MulticoreTSNE # tSNA algo
    pip install --index http://10.7.108.15:3141/root/dev/ pqkmeans==1.0.4 --trusted-host 10.7.108.15
    curl -LO http://silicos-it.be.s3-website-eu-west-1.amazonaws.com/_downloads/qed-1.0.1.tar.gz
    mv qed-*.tar.gz /usr/local/src/
    cd /usr/local/src/
    tar -xvf qed-*.tar.gz
    cd qed-*
    python setup.py install
    pip install https://github.com/rogerbinns/apsw/releases/download/3.24.0-r1/apsw-3.24.0-r1.zip --global-option=fetch --global-option=--version --global-option=3.24.0 --global-option=--all --global-option=build --global-option=--enable-all-extensions
    pip install fancyimpute # matrix completion and imputation algorithms
    conda install -y -c rdkit rdkit
    conda install -y -c openbabel openbabel
    conda install -y mkl-service
    conda install -y anaconda-client
    conda install -y faiss-cpu -c pytorch # facebook trick for sparsity


